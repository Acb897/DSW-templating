{# This is the template starter file generated by DSW TDK #}
{%- set km = ctx.knowledgeModel -%}
{%- set repliesMap = ctx.questionnaireReplies -%}
{# Name #}
{%- set user = ctx.createdBy -%}
{# DESCRIBING DATA #}
{%- set chapterDescribingUUID = "d5b27482-b598-4b8c-b534-417d4ad27394" -%}
{%- set q1UUID = "0e1db5af-7424-46b8-83ab-6e05a629325c"-%}
{%- set q1Path = [chapterDescribingUUID, q1UUID]|reply_path -%}
{%- set q1 = repliesMap[q1Path]|reply_str_value -%}
{%- set q1Answer = km.entities.answers[q1] -%} {#This contains the object  of the answer itself#}
{%- set a1AUUID =  "920e075d-598a-442d-bb8a-de3ce1811de5"-%} {# Yes #}
{%- set a1BUUID =  "ccc0cc42-d8e3-4e15-a299-9b195f42f5e4"-%} {# No #}
{%- set q1B1UUID = "8fe38d3c-0292-4fcb-81e3-a60c3c43eaed" -%} {# Can you reach out to your software provider to help you set up the FDP? #}
{%- set a1B1AUUID = "3ed16946-511c-43fa-ab4e-d9e0a836cff7" -%} {# Yes #}
{%- set a1B1BUUID = "c95c0442-aa97-4e6a-90d0-dd8860aff853" -%} {# No #}
{%- set q1B1Path = [q1Path, a1BUUID, q1B1UUID]|reply_path -%}
{%- set q1B1 = repliesMap[q1B1Path]|reply_str_value -%}
{%- set a1B1o = km.entities.answers[q1B1] -%}

<!DOCTYPE html>
<html>
    <head>
        <title>SmartGuidance</title>
        <meta charset="utf-8">
    </head>
    <body>
        <h1>Demo</h1>

    <ol>
    {% for chapterUuid in km.chapterUuids %}
      {% set chapter = km.entities.chapters[chapterUuid] %}
      <li>{{ chapter.title }}
      <ol>
      {% for questionUuid in chapter.questionUuids %}
        {% set question = km.entities.questions[questionUuid] %}
        {% set reply = repliesMap[[chapterUuid, questionUuid]|reply_path] %}
        <li>{{ question.title }} {% if reply %}✔️{% else %}❌{% endif %}</li>
      {% endfor %}
      </ol>
      </li>
    {% endfor %}
    </ol>
    
    <h2>1. Introduction</h2>

    <p>Dear {{ user.firstName }} {{user.lastName}}, Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

    <h2>6. Describing data</h2>
    
    {% if q1 %}
        {% if q1 == a1AUUID %}
            {%- set answer = " you answered yes. We recommend to " + q1Answer.advice[0].lower() + q1Answer.advice[1:] -%}
        {% elif q1 == a1BUUID %}
            {%- set answer = "you answered no. " -%}
            
            {% if q1B1 == a1B1AUUID %}
                {%- set answer = answer + "Then, we asked about whether or not you could reach out to your software provider to help you set up the Fair Data Point, and your answer was yes. We recommend to  " + a1B1o.advice[0] + a1B1o.advice[1:] -%}
            {% elif q1B1 == a1B1BUUID %}
                {%- set answer = answer + "Then, we asked about whether or not you could reach out to your software provider to help you set up the Fair Data Point, and your answer was yes. We recommend to  " + a1B1o.advice[0] + a1B1o.advice[1:] -%}
            {% else %}

                {%- set answer = answer + "You didn't answer the follow-up question yet, so we can't give you personalized advice" -%}
            {% endif %}

        {% else %}
            {%- set answer = "you haven't provided an answer yet. Please, answer the question and come back to see personalized advice" -%}
        {% endif %}
        <p>We asked you if you had exposed your metadata on a Fair Data Point, to which {{ answer }}</p>
        
    {% else %}
        <p>You still haven't answered any question in this section, so we can't provide you with personalized advice. Please, go back to the questionnaire and answer the questions and come back to this document</p>
    {% endif %}

    {# <hr>
    <pre>{{ ctx|tojson(4) }}</pre> #}

    </body>
</html>

